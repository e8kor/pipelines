#!/bin/bash

node1="192.168.0.211"
node2="192.168.0.212"
node3="192.168.0.213"
node4="192.168.0.214"
node5="192.168.0.215"
node6="192.168.0.216"

if ! [ -x "$(command -v arkade)" ]; then
    echo ' arkade is not installed.'
    curl -sSL https://dl.get-arkade.dev | sudo sh
fi

if ! [ -x "$(command -v k3sup)" ]; then
    echo 'k3sup is not installed.'
    arkade get k3sup
fi

read -p "Initialize cluster? [Y/n]" -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]
then
    k3sup install --ip $node1 --user pi --local-path ~/.kube/config \
        && k3sup join --ip $node2 --server-ip $node1 --user pi \
        && k3sup join --ip $node3 --server-ip $node1 --user pi \
        && k3sup join --ip $node4 --server-ip $node1 --user pi \
        && k3sup join --ip $node5 --server-ip $node1 --user pi \
        && k3sup join --ip $node6 --server-ip $node1 --user pi
    
fi